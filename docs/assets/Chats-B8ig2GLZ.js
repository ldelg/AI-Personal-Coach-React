import{u as g,a as v,r as o,i as N,c as r,s as f,b as C,j as e,l as w,d as k,v as y}from"./index-_xCddFYc.js";const j=()=>g(),h=v;function S(s=550){const a=typeof window<"u",[l,n]=o.useState(a?window.innerWidth>s:!0);return o.useEffect(()=>{const t=()=>n(window.innerWidth>s);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[s]),l}function R(s){const a=j(),{busy:l}=h(n=>n.chat);return n=>{const t=n.trim();if(!(!t||l)){if(!N()){a(r.setModelLoaded(!1));return}a(r.appendUser(t)),a(f(t)),s?.()}}}function E({sidebarOpen:s,isWide:a,onOpen:l,onClose:n}){const t=j(),{chats:u,activeChatId:m,model:d}=h(c=>c.chat),{roleText:b,activeRole:x,roleLocked:i}=h(C);return e.jsxs(e.Fragment,{children:[s&&!a&&e.jsx("div",{className:"sidebar-backdrop",onClick:n}),!s&&a&&e.jsx("div",{className:"sidebar-column",children:e.jsx("button",{className:"sidebar-toggle","aria-label":"Open sidebar",onClick:l,children:"☰"})}),!s&&!a&&e.jsx("div",{className:"sidebar-handle",onClick:l,children:e.jsx("button",{className:"sidebar-toggle","aria-label":"Open sidebar",children:"☰"})}),e.jsxs("aside",{className:`chat-sidebar ${s?"":"hidden"} ${s&&!a?"overlay":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h2",{children:"Offline Chat"}),e.jsx("button",{className:"sidebar-toggle","aria-label":s?"Hide sidebar":"Show sidebar",onClick:n,children:"☰"})]}),e.jsx("button",{className:"primary-btn",onClick:()=>t(w()),disabled:d.loading,children:d.loading?"Loading model…":d.loaded?"Model loaded":"Load model"}),e.jsx("div",{className:"model-progress",children:d.progress}),e.jsx("label",{className:"label",children:"Role / System Prompt"}),e.jsx("textarea",{className:"role-input",rows:6,value:i?x:b,disabled:i,onChange:c=>t(r.setRoleText(c.target.value)),placeholder:'e.g. "You are a boxing coach. Be strict and concise."'}),i&&e.jsx("div",{className:"hint",children:'Role is locked for this chat. Click "New chat" to change it.'}),e.jsx("button",{className:"secondary-btn",onClick:()=>t(r.createChat()),children:"New chat"}),e.jsx("div",{className:"chat-tabs",children:Object.values(u).map(c=>e.jsxs("div",{className:`chat-tab ${c.id===m?"active":""}`,onClick:()=>t(r.setActiveChat(c.id)),children:[e.jsx("span",{className:"chat-tab-title",children:c.title}),e.jsx("button",{className:"chat-tab-delete",onClick:p=>{p.stopPropagation(),t(r.deleteChat(c.id))},title:"Delete chat",children:"×"})]},c.id))})]})]})}function L(){const s=j(),{busy:a}=h(i=>i.chat),l=h(k),n=S(550),t=o.useRef(null),[u,m]=o.useState(n),[d,b]=o.useState(""),x=R(()=>b(""));return o.useEffect(()=>{t.current?.scrollIntoView({behavior:"smooth"})},[l.length,a]),o.useEffect(()=>{s(y())},[s]),e.jsxs("div",{className:`chat-page ${u?"":"sidebar-collapsed"}`,children:[e.jsx(E,{sidebarOpen:u,isWide:n,onOpen:()=>m(!0),onClose:()=>m(!1)}),e.jsxs("main",{className:"chat-main",children:[e.jsxs("header",{className:"chat-header",children:[e.jsx("span",{children:"Chat"}),a&&e.jsx("span",{className:"thinking",children:"Thinking…"})]}),e.jsxs("div",{className:"chat-messages",children:[l.length===0&&e.jsx("div",{className:"chat-empty",children:"Load the model, set a role, and start chatting."}),l.map((i,c)=>e.jsx("div",{className:`chat-row ${i.role==="user"?"user":"assistant"}`,children:e.jsx("div",{className:"chat-bubble",children:i.content})},c)),e.jsx("div",{ref:t})]}),e.jsxs("footer",{className:"chat-input",children:[e.jsx("input",{value:d,onChange:i=>b(i.target.value),placeholder:"Type a message…",disabled:a,onKeyDown:i=>{i.key==="Enter"&&x(d)}}),e.jsx("button",{className:"send-btn",onClick:()=>x(d),disabled:a||!d.trim(),children:"Send"})]})]})]})}export{L as default};
