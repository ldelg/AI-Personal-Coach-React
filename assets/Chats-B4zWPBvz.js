import{r as c,i as p,c as h,s as f,a as v,j as e,l as N,b as C,v as w}from"./index-DpazE5Un.js";import{u as j,a as m}from"./hooks-BVj7Wkg8.js";function y(t=550){const a=typeof window<"u",[d,i]=c.useState(a?window.innerWidth>t:!0);return c.useEffect(()=>{const l=()=>i(window.innerWidth>t);return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[t]),d}function k(t){const a=j(),{busy:d,model:i}=m(l=>l.chat);return l=>{const n=l.trim();if(!(!n||d||!i.loaded)){if(!p()){a(h.setModelLoaded(!1));return}a(h.appendUser(n)),a(f(n)),t?.()}}}function S({sidebarOpen:t,isWide:a,onOpen:d,onClose:i}){const l=j(),{chats:n,activeChatId:b,model:o}=m(s=>s.chat),{roleText:u,activeRole:x,roleLocked:r}=m(v);return e.jsxs(e.Fragment,{children:[t&&!a&&e.jsx("div",{className:"sidebar-backdrop",onClick:i}),!t&&a&&e.jsx("div",{className:"sidebar-column",children:e.jsx("button",{className:"sidebar-toggle","aria-label":"Open sidebar",onClick:d,children:"☰"})}),!t&&!a&&e.jsx("div",{className:"sidebar-handle",onClick:d,children:e.jsx("button",{className:"sidebar-toggle","aria-label":"Open sidebar",children:"☰"})}),e.jsxs("aside",{className:`chat-sidebar ${t?"":"hidden"} ${t&&!a?"overlay":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h2",{className:"sidebar-title",children:"Offline Chat"}),e.jsx("button",{className:"sidebar-toggle","aria-label":t?"Hide sidebar":"Show sidebar",onClick:i,children:"☰"})]}),e.jsx("button",{className:"primary-btn",onClick:()=>l(N()),disabled:o.loading,children:o.loading?"Loading model…":o.loaded?"Model loaded":"Load model"}),e.jsx("div",{className:"model-progress",children:o.progress}),e.jsx("label",{className:"label",children:"Role / System Prompt"}),e.jsx("textarea",{className:"role-input",rows:6,value:r?x:u,disabled:r,onChange:s=>l(h.setRoleText(s.target.value)),placeholder:'e.g. "You are a boxing coach. Be strict and concise."'}),r&&e.jsx("div",{className:"hint",children:'Role is locked for this chat. Click "New chat" to change it.'}),e.jsx("button",{className:"secondary-btn",onClick:()=>l(h.createChat()),children:"New chat"}),e.jsx("div",{className:"chat-tabs",children:Object.values(n).map(s=>e.jsxs("div",{className:`chat-tab ${s.id===b?"active":""}`,onClick:()=>l(h.setActiveChat(s.id)),children:[e.jsx("span",{className:"chat-tab-title",children:s.title}),e.jsx("button",{className:"chat-tab-delete",onClick:g=>{g.stopPropagation(),l(h.deleteChat(s.id))},title:"Delete chat",children:"×"})]},s.id))})]})]})}function E(){const t=j(),{busy:a}=m(s=>s.chat),{model:d}=m(s=>s.chat),i=m(C),l=y(550),n=c.useRef(null),[b,o]=c.useState(l),[u,x]=c.useState(""),r=k(()=>x(""));return c.useEffect(()=>{n.current?.scrollIntoView({behavior:"smooth"})},[i.length,a]),c.useEffect(()=>{sessionStorage.getItem("modelVerified")||(t(w()),sessionStorage.setItem("modelVerified","true"))},[t]),e.jsxs("div",{className:`chat-page ${b?"":"sidebar-collapsed"}`,children:[e.jsx(S,{sidebarOpen:b,isWide:l,onOpen:()=>o(!0),onClose:()=>o(!1)}),e.jsxs("main",{className:"chat-main",children:[e.jsxs("header",{className:"chat-header",children:[e.jsx("span",{children:"Chat"}),e.jsx("span",{style:{marginLeft:12,fontSize:12,color:"#665"},children:d.loaded?`Model: ${d.modelId??"loaded"}`:d.loading?"Model: loading…":"Model: not loaded"}),a&&e.jsx("span",{className:"thinking",children:"Thinking…"})]}),e.jsxs("div",{className:"chat-messages",children:[i.length===0&&e.jsx("div",{className:"chat-empty",children:"Load the model, set a role, and start chatting."}),i.map((s,g)=>e.jsx("div",{className:`chat-row ${s.role==="user"?"user":"assistant"}`,children:e.jsx("div",{className:"chat-bubble",children:s.content})},g)),e.jsx("div",{ref:n})]}),e.jsxs("footer",{className:"chat-input",children:[e.jsx("input",{value:u,onChange:s=>x(s.target.value),placeholder:"Type a message…",disabled:a,onKeyDown:s=>{s.key==="Enter"&&!a&&d.loaded&&r(u)}}),e.jsx("button",{className:"send-btn",onClick:()=>r(u),disabled:a||!d.loaded,title:d.loaded?void 0:d.loading?"Model is loading…":"Model not loaded — please load a model in Settings",children:"Send"})]})]})]})}export{E as default};
